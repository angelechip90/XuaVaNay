<app-header [title]="'Xưa & Nay ( số Tết Canh Dần 349 + 350)'" [showBackButton]="true"></app-header>

<!-- Content -->
<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Thread -->
  <ng-container *ngFor="let m of msgs()">
    <!-- USER block -->
    <section class="block user" *ngIf="m.role === 'user'">
      <div class="chip">
        <img class="avatar" [src]="m.avatar" alt="user" />
        <span class="name">{{ m.author }}</span>
      </div>

      <div class="prompt" *ngIf="m.title">{{ m.title }}</div>

      <!-- Thẻ nguồn tham khảo -->
      <div class="refs" *ngIf="m.refs?.length">
        <div class="ref-card" *ngFor="let r of m.refs">
          <div class="ref-summary">{{ r.summary }}</div>
          <div class="ref-source-row">
            <div class="ref-icon" [class.yellow]="r.iconColor==='yellow'" [class.pink]="r.iconColor==='pink'">
              <div class="dot"></div>
            </div>
            <div class="ref-source">{{ r.source }}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ASSISTANT block -->
    <section class="block bot" *ngIf="m.role === 'assistant'">
      <div class="bot-chip">
        <div class="grad-circle">
          <div class="shine"></div>
        </div>
        <span class="name">LACVIET AI</span>
      </div>

      <div class="answer" *ngIf="m.text">
        <pre>{{ m.text }}</pre>
      </div>

      <!-- Actions (text) -->
      <div class="actions" *ngIf="m.kind !== 'image'">
        <button class="act left" (click)="copy(m)">
          <ion-icon name="copy-outline"></ion-icon><span>Copy</span>
        </button>
        <button class="act" (click)="share(m)">
          <ion-icon name="share-social-outline"></ion-icon><span>Share</span>
        </button>
        <button class="act right" (click)="regenerate(m)">
          <ion-icon name="refresh-outline"></ion-icon><span>Regenerate</span>
        </button>
      </div>

      <!-- Actions (image) -->
      <div class="actions" *ngIf="m.kind === 'image'">
        <button class="act left" (click)="download(m)">
          <ion-icon name="download-outline"></ion-icon><span>Download</span>
        </button>
        <button class="act" (click)="share(m)">
          <ion-icon name="share-social-outline"></ion-icon><span>Share</span>
        </button>
        <button class="act right" (click)="regenerate(m)">
          <ion-icon name="refresh-outline"></ion-icon><span>Regenerate</span>
        </button>
      </div>
    </section>

    <div class="thin-divider"></div>
  </ng-container>
</ion-content>

<app-input-chat (valueChange)="onValueChange($event)" (sendMessage)="onSendMessage($event)"></app-input-chat>