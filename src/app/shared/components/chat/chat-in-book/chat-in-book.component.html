<!-- Header -->
<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goBack()" aria-label="Quay lại">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="ion-text-center">
      Xưa & Nay ( số Tết Canh Dần 349 + 350)
    </ion-title>

    <ion-buttons slot="end">
      <ion-button fill="clear" aria-label="Menu">
        <svg width="30" height="21" viewBox="0 0 30 21" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6.25 17.6667H27.9167C28.607 17.6667 29.1667 18.2263 29.1667 18.9167C29.1667 19.5495 28.6963 20.0725 28.0863 20.1553L27.9167 20.1667H6.25C5.55965 20.1667 5 19.607 5 18.9167C5 18.2838 5.47025 17.7608 6.08038 17.678L6.25 17.6667ZM27.9167 11.6667C28.607 11.6667 29.1667 12.2263 29.1667 12.9167C29.1667 13.5495 28.6963 14.0725 28.0863 14.1553L27.9167 14.1667H10.25C9.55965 14.1667 9 13.607 9 12.9167C9 12.2838 9.47025 11.7608 10.0804 11.678L10.25 11.6667H27.9167ZM4.58333 0C6.46602 0 8.13602 1.14593 8.8318 2.86127C9.0913 3.50098 8.78305 4.22995 8.14332 4.48945C7.5569 4.72732 6.8955 4.48813 6.58947 3.95387L6.51513 3.80097C6.19875 3.021 5.43948 2.5 4.58333 2.5C3.43273 2.5 2.5 3.43273 2.5 4.58333C2.5 5.73393 3.43273 6.66667 4.58333 6.66667H23.75C24.4403 6.66667 25 7.22632 25 7.91667C25 8.5495 24.5297 9.0725 23.9197 9.15533L23.75 9.16667H4.58333C2.05203 9.16667 0 7.11463 0 4.58333C0 2.05203 2.05203 0 4.58333 0ZM27.9167 1.66667C28.607 1.66667 29.1667 2.22632 29.1667 2.91667C29.1667 3.5495 28.6963 4.07248 28.0863 4.15525L27.9167 4.16667H12.9167C12.2263 4.16667 11.6667 3.60702 11.6667 2.91667C11.6667 2.28383 12.137 1.76085 12.747 1.67808L12.9167 1.66667H27.9167Z"
            fill="url(#paint0_linear_54880_3434)" />
          <defs>
            <linearGradient id="paint0_linear_54880_3434" x1="-0.416666" y1="25" x2="33.75" y2="-2.18962e-07"
              gradientUnits="userSpaceOnUse">
              <stop stop-color="#801DFE" />
              <stop offset="0.459298" stop-color="#CE2276" />
              <stop offset="1" stop-color="#ED1C24" />
            </linearGradient>
          </defs>
        </svg>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Badge thông báo -->
  <div class="notif-badge" *ngIf="notifCount() > 0">
    {{ notifCount() }}
  </div>
</ion-header>

<!-- Content -->
<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Thread -->
  <ng-container *ngFor="let m of msgs()">
    <!-- USER block -->
    <section class="block user" *ngIf="m.role === 'user'">
      <div class="chip">
        <img class="avatar" [src]="m.avatar" alt="user" />
        <span class="name">{{ m.author }}</span>
      </div>

      <div class="prompt" *ngIf="m.title">{{ m.title }}</div>

      <!-- Thẻ nguồn tham khảo -->
      <div class="refs" *ngIf="m.refs?.length">
        <div class="ref-card" *ngFor="let r of m.refs">
          <div class="ref-summary">{{ r.summary }}</div>
          <div class="ref-source-row">
            <div class="ref-icon" [class.yellow]="r.iconColor==='yellow'" [class.pink]="r.iconColor==='pink'">
              <div class="dot"></div>
            </div>
            <div class="ref-source">{{ r.source }}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ASSISTANT block -->
    <section class="block bot" *ngIf="m.role === 'assistant'">
      <div class="bot-chip">
        <div class="grad-circle">
          <div class="shine"></div>
        </div>
        <span class="name">LACVIET AI</span>
      </div>

      <div class="answer" *ngIf="m.text">
        <pre>{{ m.text }}</pre>
      </div>

      <!-- Actions (text) -->
      <div class="actions" *ngIf="m.kind !== 'image'">
        <button class="act left" (click)="copy(m)">
          <ion-icon name="copy-outline"></ion-icon><span>Copy</span>
        </button>
        <button class="act" (click)="share(m)">
          <ion-icon name="share-social-outline"></ion-icon><span>Share</span>
        </button>
        <button class="act right" (click)="regenerate(m)">
          <ion-icon name="refresh-outline"></ion-icon><span>Regenerate</span>
        </button>
      </div>

      <!-- Actions (image) -->
      <div class="actions" *ngIf="m.kind === 'image'">
        <button class="act left" (click)="download(m)">
          <ion-icon name="download-outline"></ion-icon><span>Download</span>
        </button>
        <button class="act" (click)="share(m)">
          <ion-icon name="share-social-outline"></ion-icon><span>Share</span>
        </button>
        <button class="act right" (click)="regenerate(m)">
          <ion-icon name="refresh-outline"></ion-icon><span>Regenerate</span>
        </button>
      </div>
    </section>

    <div class="thin-divider"></div>
  </ng-container>
</ion-content>

<app-input-chat (valueChange)="onValueChange($event)" (sendMessage)="onSendMessage($event)"></app-input-chat>